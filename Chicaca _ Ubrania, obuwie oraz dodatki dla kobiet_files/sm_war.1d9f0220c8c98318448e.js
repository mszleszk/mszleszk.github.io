__smjsonp__([5],{369:function(t,n,e){"use strict";(function(n){function i(){var t=this,n=null;t.get=function(){return t.requestPromise&&!f.isSPA()?t.requestPromise:t.requestPromise=new Promise(function(e,i){if(t.config&&!f.isSPA())return e(t.config);var l=o.urls.war_config,p=o.war_endpoint,d=a.getContactId();(new r).withEndpoint(p).withPath(l).ap("s",c.get("_smapp")+c.get("_smid")).ap("u",d.smuuid).ap("d",window.location.host+window.location.pathname).ap("c",d.smclient).ajaxGet().then(function(i){n&&(clearTimeout(n),n=null,t.config=u.from(i),e(t.config))}).catch(function(){i()}),n=setTimeout(function(){i()},s.WAR_CONFIG_REQUEST_TIMEOUT)})}}var r=e(6),c=e(3),o=e(2),u=e(7),a=e(5),s=e(65),f=e(15);t.exports=new i}).call(n,e(0))},370:function(t,n,e){"use strict";(function(n){function i(){var t=this,n=null;t.report=function(e){return new Promise(function(i,f){var l=o.urls.war_report,p=o.war_endpoint,d=u.getContactId(),h={s:c.get("_smid"),i:c.get("_smapp"),id:e.id,t:e.t,rr:e.rr,smuuid:d.smuuid,smclient:d.smclient};return t.request=(new r).withEndpoint(p).withPath(l).apo(h).ajaxPost().then(function(t){n&&(clearTimeout(n),n=null,s.add(s.MODULE_KEYS.WAR,e.id),i(t))}).catch(function(){f()}),n=setTimeout(function(){f()},a.WAR_REPORT_REQUEST_TIMEOUT),t.request})}}var r=e(6),c=e(3),o=e(2),u=e(5),a=e(65),s=e(4);t.exports=new i}).call(n,e(0))},380:function(t,n,e){"use strict";(function(n){var i=e(369),r=e(87),c=e(1),o=e(65),u=e(4),a=function(t,n){var e=JSON.parse(JSON.stringify(t));e.rr=n.rr,e.t=n.t,e.rrId=n.id;var i="AFTER_X_SECONDS"==n.cfg.st?1e3*n.cfg.v:0;switch(e.warAction=n.cfg,n.cfg.at){case"sp":e.cfg.exit=n.cfg.onExit,e.cfg.delay=i,"BASIC"!==e.type&&(e.exit=!1,e.delayValue=0,e.delay=!1);break;case"scf":case"scc":case"sci":e.delayValue=i}return e},s=function(t,n,e,i){n&&t.war[e]&&n.forEach(function(n){var r=(i||t.war[e]).filter(function(t){return n.itemId==t.id})[0];r&&(r=a(r,n),t[e].unshift(r),u.add(u.MODULE_KEYS.WAR,r.id))})};t.exports=function(){var t,n=!1;return{getRunner:function(){return t||this.initRunner()},initRunner:function(){var e,a=new Promise(function(t){e=setTimeout(function(){t()},o.WAR_PROCESSING_TIMEOUT)}),f={},l=new Promise(function(t){if(n)return t(n);a.then(function(){r.get().then(function(n){t(n)})}),f.run=function(r){c.isNotNull(r.war)?(i.get().then(function(i){n||(r.war&&(u.clear(u.MODULE_KEYS.WAR),s(r,i.sp,"p",r.war.p.concat(r.war.pp).concat(r.war.ap).concat(r.war.ip)),s(r,i.scc.concat(i.sci),"c",r.c),s(r,i.scf,"f")),n=r,t(n),clearTimeout(e))},function(){clearTimeout(e),t(r)}),a.then(function(){t(r)})):t(r)}});return f.processed=l,t=f}}}()}).call(n,e(0))},381:function(t,n,e){"use strict";var i=e(382);t.exports={isWarAction:function(t){return t.rr},modifyPopupConfig:function(t,n){n.rr=t.rr,n.rrId=t.rrId,n.t=t.t,"BASIC"!==t.type&&"IMAGE"!==t.type&&"ADVANCED"!==t.type&&(n.popupCfg=t)},scheduleChatActions:function(t,n,e){return i.scheduleChatActions(t,n,e)},getChatToDisplayImmediately:function(t){return i.getChatToDisplayImmediately(t)}}},382:function(t,n,e){"use strict";var i=e(370),r=function(){var t=this;t.enabled=!0,t.ACTION_INTERVAL=1e4};r.prototype.enqueue=function(t,n){var e=this;return new Promise(function(i,r){e.enabled&&(0===n.delayValue?o(t,n).then(function(){i()},function(){r()}):setTimeout(function(){e.enabled&&o(t,n).then(function(){i()},function(){r()})},n.delayValue))})},r.prototype.setOnStateChange=function(t,n){this.enabled=!t||"fake-conversation"==t};var c=function(t){return'<div align="'+t.align+'">'+t.text+"</div>"},o=function(t,n){return new Promise(function(e,i){switch(n.warAction.at){case"scc":t.showWithMessage(c(n.warAction.content)).then(function(t){!0===t&&e(),!1===t&&i()});break;case"sci":var r=t.setBanner({html:c(n.warAction.content)});!0===r&&e(),!1===r&&i()}})},u=function(){var t=this;t.scheduler=new r,t.setOnStateChange=this.scheduler.setOnStateChange};u.prototype.scheduleChatActions=function(t,n,e){var r=this,c=!1;e.setOnStateChange=r.setOnStateChange,r.scheduler.enabled=!e.state.enabled,setTimeout(function(){n.c.filter(function(t){return t&&t.warAction&&e.chatId==t.id}).forEach(function(t){c=!0,r.scheduler.enqueue(e,t).then(function(){i.report({rr:t.rr,id:t.rrId,t:t.t})})}),c||e.setInitalState()})},u.prototype.getChatToDisplayImmediately=function(t){return t.c.filter(function(t){return t.rr})},t.exports=new u},383:function(t,n,e){"use strict";var i=e(384),r=e(369),c=e(370),o=e(4);t.exports={run:function(){r.get().then(function(t){t.ecs.forEach(function(t){o.has(o.MODULE_KEYS.WAR,t.id)||i.schedule(t.cfg.scr,{delay:"IMMEDIATELY"!==t.cfg.st?1e3*t.cfg.v:0}).then(function(){c.report({rr:t.rr,id:t.id,t:t.t})})})}).catch(function(){})}}},384:function(module,exports,__webpack_require__){"use strict";var CustomScriptExecutor=function(){};CustomScriptExecutor.prototype.execute=function(script){eval(script)},CustomScriptExecutor.prototype.schedule=function(t,n){var e=this;return new Promise(function(i){"number"==typeof n.delay&&n.delay>0?setTimeout(function(){i(),e.execute(t)},n.delay):(i(),e.execute(t))})},module.exports=new CustomScriptExecutor},86:function(t,n,e){"use strict";t.exports=new function(){this.Config=e(369),this.Properties=e(65),this.QueueModifier=e(380),this.Reporter=e(370),this.Utils=e(381),this.WarCSExecutor=e(383)}}});